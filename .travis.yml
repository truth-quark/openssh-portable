dist: xenial
sudo: required

language: c

before_install:
  - sudo apt-get update
  - sudo apt-get install -y autoconf automake gcc libtool libssl-dev make unzip xsltproc
  - sudo mkdir -p -m 0755 /var/empty
  - export LIBOQS_CODE=/tmp/liboqs
  - export LIBOQS_INSTALL=/tmp/liboqs-install
  - git clone -b master --single-branch https://github.com/open-quantum-safe/liboqs.git $LIBOQS_CODE
  - cd $LIBOQS_CODE
  - autoreconf -i
  - ./configure --prefix=$LIBOQS_INSTALL/oqs --with-pic=yes --enable-shared=no --enable-openssl --with-openssl-dir=/usr
  - make -j
  - make install
  - rm -f $LIBOQS_INSTALL/lib/liboqs.so*

script:
  - pwd
  - echo $HOME
  - export LIBOQS_INSTALL=/tmp/liboqs-install
  - export OPENSSH_INSTALL=/tmp/openssh-install
  - autoreconf
  - ./configure --enable-pq-kex --enable-hybrid-kex --prefix=$OPENSSH_INSTALL --sysconfdir=$OPENSSH_INSTALL --with-liboqs-dir=$LIBOQS_INSTALL
  - make -j
  - make install
  - make tests
